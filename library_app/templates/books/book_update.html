{% extends 'base.html' %}
{% load static %}

{% block title %}Update Book{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-8">Update Book</h1>

    <div class="bg-white shadow-lg rounded-lg p-8">
        <form method="post" class="space-y-6">
            {% csrf_token %}

            <!-- Centre (Superuser only, otherwise hidden) -->
            {% if user.is_superuser %}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Centre <span class="text-red-500">*</span></label>
                <select name="centre" id="id_centre" class="form-select w-full border-gray-300 rounded-md" required>
                    {% for centre in centres %}
                    <option value="{{ centre.id }}" {% if centre.id == book.centre.id %}selected{% endif %}>
                        {{ centre.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% else %}
            <p class="text-sm text-gray-600 mb-4">Centre: <strong>{{ book.centre.name }}</strong></p>
            <input type="hidden" name="centre" value="{{ book.centre.id }}">
            {% endif %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">School</label>
                    <select name="school" id="id_school" class="form-select w-full border-gray-300 rounded-md">
                        <option value="">-- Select School --</option>
                        {% for school in schools %}
                        <option value="{{ school.id }}" {% if book.school and school.id == book.school.id %}selected{% endif %}>
                            {{ school.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category <span class="text-red-500">*</span></label>
                    <select name="category" id="id_category" class="form-select w-full border-gray-300 rounded-md" required>
                        <option value="">-- Select Category --</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if book.category and cat.id == book.category.id %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Grade <span id="grade-required" class="text-red-500 hidden">* Required</span></label>
                    <select name="grade" id="id_grade" class="form-select w-full border-gray-300 rounded-md">
                        <option value="">-- Select Grade --</option>
                        {% for grade in grades %}
                        <option value="{{ grade.id }}" {% if book.grade and grade.id == book.grade.id %}selected{% endif %}>
                            {{ grade.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Subject <span id="subject-required" class="text-red-500 hidden">* Required</span></label>
                    <select name="subject" id="id_subject" class="form-select w-full border-gray-300 rounded-md">
                        <option value="">-- Select Subject --</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}" {% if book.subject and subject.id == book.subject.id %}selected{% endif %}>
                            {{ subject.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title <span class="text-red-500">*</span></label>
                    <input type="text" name="title" value="{{ book.title }}" class="form-input w-full border-gray-300 rounded-md" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Author <span class="text-red-500">*</span></label>
                    <input type="text" name="author" value="{{ book.author }}" class="form-input w-full border-gray-300 rounded-md" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ISBN <span class="text-red-500">*</span></label>
                    <input type="text" name="isbn" value="{{ book.isbn }}" class="form-input w-full border-gray-300 rounded-md" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Publisher <span class="text-red-500">*</span></label>
                    <input type="text" name="publisher" value="{{ book.publisher }}" class="form-input w-full border-gray-300 rounded-md" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Publication Year <span class="text-red-500">*</span></label>
                    <input type="number" name="year_of_publication" value="{{ book.year_of_publication }}" min="1500" max="2030" class="form-input w-full border-gray-300 rounded-md" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Book Code</label>
                    <input type="text" name="book_code" value="{{ book.book_code|default:'' }}" class="form-input w-full border-gray-300 rounded-md">
                </div>
            </div>

            <div class="flex justify-end space-x-4 pt-6">
                <a href="{% url 'final_book_list' book.category.id %}" class="px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</a>
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Update Book</button>
            </div>
        </form>
    </div>
</div>

{% include 'books/partials/book_form_scripts.html' %}




{% endblock %}