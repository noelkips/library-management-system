{% extends 'base.html' %}

{% block title %}{{ grade.name }} Books{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">
    <a href="{% url 'school_catalog' school.id %}" class="text-blue-600 hover:underline mb-6 inline-block">‚Üê Back to Catalog</a>

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">{{ grade.name }} Books</h1>
        {% if is_staff %}
        <a href="{% url 'book_add' %}" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">Add Book</a>
        {% endif %}
    </div>

    <div class="mb-6 flex space-x-4">
        <select onchange="this.form.submit()" name="category" class="form-select border-gray-300 rounded-md">
            <option value="all" {% if not selected_category %}selected{% endif %}>All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}" {% if selected_category == cat.id %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>

        <select onchange="this.form.submit()" name="subject" class="form-select border-gray-300 rounded-md">
            <option value="all" {% if not selected_subject %}selected{% endif %}>All Subjects</option>
            {% for sub in subjects %}
            <option value="{{ sub.id }}" {% if selected_subject == sub.id %}selected{% endif %}>{{ sub.name }}</option>
            {% endfor %}
        </select>

        <input type="text" name="q" value="{{ query }}" placeholder="Search books..." class="form-input border-gray-300 rounded-md">
        <label class="flex items-center">
            <input type="checkbox" name="available" {% if available_only %}checked{% endif %} onchange="this.form.submit()" class="mr-2">
            Available only
        </label>
    </div>

    <table class="w-full bg-white rounded-xl shadow-md overflow-hidden">
        <thead class="bg-gray-100">
            <tr>
                <th class="p-4 text-left">Title</th>
                <th class="p-4 text-left">Author</th>
                <th class="p-4 text-left">ISBN</th>
                <th class="p-4 text-left">Status</th>
                <th class="p-4 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for book in page_obj %}
            <tr class="border-b hover:bg-gray-50">
                <td class="p-4">{{ book.title }}</td>
                <td class="p-4">{{ book.author }}</td>
                <td class="p-4">{{ book.isbn }}</td>
                <td class="p-4">
                    {% if book.available_copies %}
                    <span class="text-green-600">Available</span>
                    {% else %}
                    <span class="text-red-600">Borrowed</span>
                    {% endif %}
                </td>
                <td class="p-4">
                    {% if is_staff %}
                    <a href="{% url 'book_update' book.pk %}" class="text-blue-600 hover:underline">Edit</a>
                    <a href="{% url 'book_delete' book.pk %}" class="text-red-600 hover:underline ml-4">Delete</a>
                    {% else %}
                    <a href="{% url 'book_detail' book.pk %}" class="text-blue-600 hover:underline">View</a>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="p-4 text-center text-gray-500">No books found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-6 flex justify-center">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 bg-gray-200 rounded">Previous</a>
        {% endif %}
        <span class="px-4 py-2">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 bg-gray-200 rounded">Next</a>
        {% endif %}
    </div>
</div>
{% endblock %}