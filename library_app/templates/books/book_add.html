{% extends 'base.html' %}

{% block title %}Add Book - LibraryHub{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6 text-primary flex items-center animate-fade-in">
    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
    </svg>
    Add Book
</h1>

{% if messages %}
    <div class="mb-6 space-y-2">
        {% for message in messages %}
            <div class="{% if message.tags == 'green' %}bg-green-500{% else %}bg-danger{% endif %} text-white p-3 rounded-lg shadow animate-slide-in">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<div class="bg-white p-6 rounded-lg shadow-lg animate-fade-in">
    <h2 class="text-xl font-semibold text-primary mb-4">Add Single Book</h2>
    <p class="text-sm text-neutral mb-4">Only <code>book_code</code> is required. Other fields are optional.</p>
    <form method="post" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% csrf_token %}
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Title</label>
            <input type="text" name="title" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Author</label>
            <input type="text" name="author" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Category</label>
            <input type="text" name="category" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Book Code</label>
            <input type="text" name="book_code" required class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Publisher</label>
            <input type="text" name="publisher" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Year of Publication</label>
            <input type="number" name="year_of_publication" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Total Copies</label>
            <input type="number" name="total_copies" min="1" value="1" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Available Copies</label>
            <input type="number" name="available_copies" min="0" value="1" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Centre</label>
            <select name="centre" class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
                <option value="">None</option>
                {% for centre in centres %}
                    <option value="{{ centre.id }}">{{ centre.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="md:col-span-2 animate-slide-in">
            <button type="submit" class="bg-secondary text-white p-2 rounded flex items-center hover:bg-accent transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add Single Book
            </button>
        </div>
    </form>
</div>

<div class="bg-white p-6 rounded-lg shadow-lg mt-6 animate-fade-in">
    <h2 class="text-xl font-semibold text-primary mb-4">Upload CSV/Excel File</h2>
    <p class="text-sm text-neutral mb-4">File must include column: <code>book_code</code>. Optional: <code>book_title</code>, <code>author_name</code>, <code>category</code>, <code>publisher</code>, <code>pub_year</code>, <code>total_no</code>, <code>available_copies</code>.</p>
    <form id="uploadForm" method="post" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Select File (CSV or Excel)</label>
            <input type="file" name="file" id="fileInput" accept=".csv,.xlsx" required class="border border-neutral p-2 rounded w-full focus:ring-2 focus:ring-accent">
            <p id="fileName" class="text-sm text-neutral mt-1"></p>
        </div>
        <div class="animate-slide-in">
            <label class="block mb-1 text-primary">Centre</label>
            <select name="centre_id" id="centreSelect" required class="w-full border border-neutral p-2 rounded focus:ring-2 focus:ring-accent">
                <option value="">Select a centre</option>
                {% for centre in centres %}
                    <option value="{{ centre.id }}">{{ centre.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="bg-secondary text-white p-2 rounded flex items-center hover:bg-accent transition-colors animate-slide-in">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
            </svg>
            Upload File
        </button>
    </form>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const fileNameDisplay = document.getElementById('fileName');

    fileInput.addEventListener('change', () => {
        fileNameDisplay.textContent = fileInput.files.length ? `Selected: ${fileInput.files[0].name}` : '';
    });
</script>

<style>
    .animate-fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    .animate-slide-in {
        animation: slideIn 0.5s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    @keyframes slideIn {
        from { transform: translateY(10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
</style>
{% endblock %}